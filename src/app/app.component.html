<mat-toolbar class="header header--primary" color="primary">
  <span>{{token?.name}} wallet</span>
  <span></span>
</mat-toolbar>
<mat-toolbar class="header header--secondary" color="accent">
  <span>
    <div class="blockie blockie--big" *ngIf="account" [style.background-image]="getImageOf(account)"></div>
    <span class="header__account">{{account}}</span>
  </span>
  <div class="header__balance">
    <div class="header__balance-row">Balance:<code> {{balance$ | async}} {{token?.symbol}}</code></div>
    <div class="header__balance-row" *ngIf="(balance$ | async) !== 0">
      Available:<code> {{availableBalance$ | async}} {{token?.symbol}}</code>
    </div>
    <div class="header__balance-row" *ngIf="(balance$ | async) === 0">
      <code class="link" (click)="dripToMe()">Claim a {{token?.symbol}}</code>
    </div>
  </div>
</mat-toolbar>

<div class="container">

  <form #newBetForm="ngForm" novalidate>
    <mat-card class="new-bet" [class.new-bet--disabled]="creatingBet">
      <mat-card-header>
        <mat-card-title>New bet</mat-card-title>
        <mat-card-subtitle>
          <mat-icon>warning</mat-icon>
          You won't win the bet (your word is worth less than 1 {{token?.symbol}})
        </mat-card-subtitle>
      </mat-card-header>

      <mat-form-field class="new-bet__address" floatPlaceholder="never">
        <div
          matPrefix
          class="blockie blockie--prefix"
          [style.background-image]="newBet.against ? getImageOf(newBet.against) : ''">
        </div>
        <input
          matInput
          [(ngModel)]="newBet.against"
          type="text"
          name="newBetAgainst"
          placeholder="0x0000000000000000000000000000000000000000"
          required>
      </mat-form-field>

      <div class="new-bet__cols">
        <mat-form-field class="new-bet__amount">
          <span matSuffix>{{token?.symbol}}</span>
          <input
            matInput
            name="newBetAmount"
            type="number"
            placeholder="Amount"
            [(ngModel)]="newBet.amount"
            required
            [disabled]="(availableBalance$ | async) === 0"
            min="1"
            [max]="availableBalance$ | async">
        </mat-form-field>

        <div class="new-bet__cols-span"></div>

        <mat-form-field class="new-bet__bet">
          <input
            matInput
            name="newBetBet"
            type="text"
            placeholder="Bet"
            [(ngModel)]="newBet.bet"
            required>
        </mat-form-field>
      </div>


      <mat-card-actions>
        <button mat-button (click)="newBetForm.reset()" type="button">Clear</button>
        <button
          mat-button
          color="primary"
          type="button"
          [disabled]="!newBetForm.valid && (availableBalance$ | async) !== 0"
          (click)="createBet()">

          Submit bet
        </button>
      </mat-card-actions>
    </mat-card>
  </form>

  <mat-accordion class="bets-list">
    <mat-expansion-panel
      *ngFor="let bet of myBets$ | async; trackBy: trackBet"
      class="bets-list__bet"
      [class.bets-list__bet--opened]="openedBet === bet.id"
      [expanded]="openedBet === bet.id"
      (opened)="openedBet = bet.id"
      (closed)="openedBet === bet.id ? openedBet = undefined : null"
      [hideToggle]="true">

      <mat-expansion-panel-header>
        <div class="bets-list__status bets-list__status--{{bet.accepted ? 'ok' : 'wait'}}"></div>
        <mat-panel-title class="bets-list__title-wrapper">
          <div class="bets-list__title">
            <div class="blockie" [style.background-image]="getImageOf(bet.from)">
              <mat-icon *ngIf="bet.from === account">account_circle</mat-icon>
            </div>
            <span class="bets-list__vs">VS.</span>
            <div class="blockie" [style.background-image]="getImageOf(bet.against)">
              <mat-icon *ngIf="bet.against === account">account_circle</mat-icon>
            </div>
          </div>
        </mat-panel-title>
        <mat-panel-description class="bets-list__description">
          <div class="bets-list__description-text">{{bet.bet}}</div>
          <div class="bets-list__description-amount">{{bet.amount}} {{token?.symbol}}</div>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <div class="bets-list__address">
        <div class="blockie" [style.background-image]="getImageOf(bet.from)">
          <mat-icon *ngIf="bet.from === account">account_circle</mat-icon>
        </div><!--
     --><span class="bets-list__address-text">{{bet.from}}</span>
      </div>
      <div class="bets-list__address">
        <div class="blockie" [style.background-image]="getImageOf(bet.against)">
          <mat-icon *ngIf="bet.against === account">account_circle</mat-icon>
        </div><!--
     --><span class="bets-list__address-text">{{bet.against}}</span>
      </div>


      <mat-action-row>
        <button mat-button
          *ngIf="bet.against.toLowerCase() === account.toLowerCase() && !bet.accepted"
          color="primary"
          (click)="accept(bet, true)"
          [disabled]="(availableBalance$ | async) < bet.amount"
          type="button">

          Accept
        </button>
        <button mat-button
          *ngIf="bet.against.toLowerCase() === account.toLowerCase() && !bet.accepted"
          color="warn"
          (click)="accept(bet, false)"
          type="button">

          Reject
        </button>
        <button mat-button
          *ngIf="bet.against.toLowerCase() === account.toLowerCase() && bet.accepted"
          color="primary"
          (click)="giveMeTheMoney(bet)"
          type="button">

          Give me the money
        </button>
        <button mat-button
          *ngIf="bet.from.toLowerCase() === account.toLowerCase()"
          color="primary"
          (click)="cryAndForgotBet(bet)"
          type="button">

          Cry and forgot the bet
        </button>
      </mat-action-row>
    </mat-expansion-panel>
  </mat-accordion>

</div>
